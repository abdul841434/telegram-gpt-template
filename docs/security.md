# Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ

## ÐžÐ±Ð·Ð¾Ñ€

ÐŸÑ€Ð¾ÐµÐºÑ‚ Ð²ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ Ð²ÑÑ‚Ñ€Ð¾ÐµÐ½Ð½Ñ‹Ðµ Ð¼ÐµÑ…Ð°Ð½Ð¸Ð·Ð¼Ñ‹ Ð·Ð°Ñ‰Ð¸Ñ‚Ñ‹ Ð¸ ÑÐ»ÐµÐ´ÑƒÐµÑ‚ best practices Ð´Ð»Ñ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾Ð¹ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Telegram-Ð±Ð¾Ñ‚Ð¾Ð².

## Ð’ÑÑ‚Ñ€Ð¾ÐµÐ½Ð½Ð°Ñ Ð·Ð°Ñ‰Ð¸Ñ‚Ð°

### 1. Ð—Ð°Ñ‰Ð¸Ñ‚Ð° Ð¾Ñ‚ SQL Injection

Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ `aiosqlite` Ñ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¸Ð·Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¼Ð¸ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°Ð¼Ð¸:

```python
# ÐŸÑ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾ (Ð·Ð°Ñ‰Ð¸Ñ‰ÐµÐ½Ð¾)
await db.execute(
    "SELECT * FROM users WHERE user_id = ?",
    (user_id,)
)

# ÐÐµÐ¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾ (ÑƒÑÐ·Ð²Ð¸Ð¼Ð¾)
await db.execute(
    f"SELECT * FROM users WHERE user_id = {user_id}"
)
```

Ð’ÑÐµ Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ðº Ð‘Ð” Ð² Ð¿Ñ€Ð¾ÐµÐºÑ‚Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽÑ‚ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¸Ð·Ð°Ñ†Ð¸ÑŽ.

### 2. Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾Ðµ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ñ‚Ð¾ÐºÐµÐ½Ð¾Ð²

Ð’ÑÐµ Ñ‡ÑƒÐ²ÑÑ‚Ð²Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ñ…Ñ€Ð°Ð½ÑÑ‚ÑÑ Ð² `.env` Ñ„Ð°Ð¹Ð»Ðµ, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹:
- ÐÐµ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ð¸Ñ‚ÑÑ Ð² Git (ÑƒÐºÐ°Ð·Ð°Ð½ Ð² `.gitignore`)
- Ð—Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÑ‚ÑÑ Ñ‡ÐµÑ€ÐµÐ· `python-dotenv`
- Ð”Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ñ€Ð¾Ñ†ÐµÑÑÑƒ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ

```python
# core/config.py
from dotenv import load_dotenv
import os

load_dotenv()

TG_TOKEN = os.getenv("TG_TOKEN")  # ÐÐ¸ÐºÐ¾Ð³Ð´Ð° Ð½Ðµ Ñ…Ð°Ñ€Ð´ÐºÐ¾Ð´Ð¸Ð¼
LLM_TOKEN = os.getenv("LLM_TOKEN")
```

### 3. Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð²Ñ…Ð¾Ð´Ð½Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ…

Ð’ÑÐµ Ð²Ñ…Ð¾Ð´ÑÑ‰Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¾Ñ‚ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð²Ð°Ð»Ð¸Ð´Ð¸Ñ€ÑƒÑŽÑ‚ÑÑ:

```python
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð´Ð»Ð¸Ð½Ñ‹ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ
MAX_MESSAGE_LENGTH = 4096
if len(text) > MAX_MESSAGE_LENGTH:
    text = text[:MAX_MESSAGE_LENGTH]

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ‚Ð¸Ð¿Ð¾Ð²
if not isinstance(user_id, int):
    raise ValueError("user_id must be integer")
```

### 4. Ð›Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð±ÐµÐ· Ñ‡ÑƒÐ²ÑÑ‚Ð²Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ…

Ð›Ð¾Ð³Ð¸ Ð½Ðµ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚:
- Ð¢Ð¾ÐºÐµÐ½Ñ‹ API
- ÐŸÐ¾Ð»Ð½Ñ‹Ðµ Ñ‚ÐµÐºÑÑ‚Ñ‹ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ (Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿ÐµÑ€Ð²Ñ‹Ðµ 100 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²)
- ÐŸÐµÑ€ÑÐ¾Ð½Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹

```python
# core/config.py
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        RotatingFileHandler(
            'logs/bot.log',
            maxBytes=10485760,  # 10MB
            backupCount=5
        )
    ]
)

# Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾Ðµ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ
logger.info(f"User {user_id} sent message (length: {len(message)})")
# Ð’Ð¼ÐµÑÑ‚Ð¾: logger.info(f"User {user_id} sent: {message}")
```

### 5. Rate Limiting

Telegram Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÑÐµÑ‚ rate limiting:
- 30 ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ Ð² ÑÐµÐºÑƒÐ½Ð´Ñƒ Ð´Ð»Ñ Ð²ÑÐµÑ… Ñ‡Ð°Ñ‚Ð¾Ð²
- 1 ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð² ÑÐµÐºÑƒÐ½Ð´Ñƒ Ð½Ð° Ð¿Ñ€Ð¸Ð²Ð°Ñ‚Ð½Ñ‹Ð¹ Ñ‡Ð°Ñ‚

Ð‘Ð¾Ñ‚ ÑƒÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ ÑÑ‚Ð¸ Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ñ Ð¸ Ð¾Ð±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸.

## Ð§ÐµÐº-Ð»Ð¸ÑÑ‚ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸

### ÐžÐ±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾

- [ ] âœ… `.env` Ñ„Ð°Ð¹Ð» Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½ Ð² `.gitignore`
- [ ] âœ… Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽÑ‚ÑÑ Ñ€Ð°Ð·Ð½Ñ‹Ðµ Ñ‚Ð¾ÐºÐµÐ½Ñ‹ Ð´Ð»Ñ dev/prod Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ð¹
- [ ] âœ… ÐŸÐ°Ñ€Ð¾Ð»Ð¸ Ð¸ Ñ‚Ð¾ÐºÐµÐ½Ñ‹ Ð½Ð¸ÐºÐ¾Ð³Ð´Ð° Ð½Ðµ Ñ…Ð°Ñ€Ð´ÐºÐ¾Ð´ÑÑ‚ÑÑ Ð² ÐºÐ¾Ð´Ðµ
- [ ] âœ… Ð ÐµÐ³ÑƒÐ»ÑÑ€Ð½Ð¾ Ð¾Ð±Ð½Ð¾Ð²Ð»ÑÑŽÑ‚ÑÑ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ (`pip list --outdated`)
- [ ] âœ… ÐžÐ³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº admin ÐºÐ¾Ð¼Ð°Ð½Ð´Ð°Ð¼ (Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° ADMIN_CHAT)
- [ ] âœ… Ð’ÑÐµ SQL Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¸Ð·Ð¾Ð²Ð°Ð½Ñ‹
- [ ] âœ… Ð›Ð¾Ð³Ð¸ Ð½Ðµ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ Ñ‡ÑƒÐ²ÑÑ‚Ð²Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ

### Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ

- [ ] ÐÐ°ÑÑ‚Ñ€Ð¾ÐµÐ½ firewall Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€Ðµ (UFW, iptables)
- [ ] Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ HTTPS Ð´Ð»Ñ webhook (ÐµÑÐ»Ð¸ Ð¿Ñ€Ð¸Ð¼ÐµÐ½Ð¸Ð¼Ð¾)
- [ ] SSH Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ð¾ ÐºÐ»ÑŽÑ‡Ð°Ð¼ (Ð±ÐµÐ· Ð¿Ð°Ñ€Ð¾Ð»ÐµÐ¹)
- [ ] Ð ÐµÐ³ÑƒÐ»ÑÑ€Ð½Ñ‹Ðµ Ð±ÑÐºÐ°Ð¿Ñ‹ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…
- [ ] ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³ Ð¿Ð¾Ð´Ð¾Ð·Ñ€Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð¹ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸
- [ ] ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸ ÐžÐ¡

## Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð¾Ð¼

### ÐÐ´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€ÑÐºÐ¸Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹

Ð’ÑÐµ admin ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð·Ð°Ñ‰Ð¸Ñ‰ÐµÐ½Ñ‹ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¾Ð¹:

```python
# handlers/admin_handlers.py
from core.config import ADMIN_CHAT

@router.message(Command("dispatch"))
async def dispatch_command(message: Message):
    # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ñ€Ð°Ð²
    if message.from_user.id != ADMIN_CHAT:
        await message.answer("Ð£ Ð²Ð°Ñ Ð½ÐµÑ‚ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº ÑÑ‚Ð¾Ð¹ ÐºÐ¾Ð¼Ð°Ð½Ð´Ðµ.")
        return
    
    # ÐžÑÐ½Ð¾Ð²Ð½Ð°Ñ Ð»Ð¾Ð³Ð¸ÐºÐ°
    ...
```

### ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° ADMIN_CHAT

Ð’ `.env`:

```env
ADMIN_CHAT=123456789  # Ð’Ð°Ñˆ Telegram User ID
```

ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ ÑÐ²Ð¾Ð¹ ID: [@userinfobot](https://t.me/userinfobot)

## Ð—Ð°Ñ‰Ð¸Ñ‚Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹

### GDPR Compliance

ÐŸÑ€Ð¾ÐµÐºÑ‚ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÐµÑ‚ Ð±Ð°Ð·Ð¾Ð²Ñ‹Ð¼ Ñ‚Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸ÑÐ¼ GDPR:

1. **ÐœÐ¸Ð½Ð¸Ð¼Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ…** â€” ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÑŽÑ‚ÑÑ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ
2. **ÐŸÑ€Ð°Ð²Ð¾ Ð½Ð° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ðµ** â€” ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° `/forget` ÑƒÐ´Ð°Ð»ÑÐµÑ‚ Ð¸ÑÑ‚Ð¾Ñ€Ð¸ÑŽ
3. **ÐŸÑ€Ð¾Ð·Ñ€Ð°Ñ‡Ð½Ð¾ÑÑ‚ÑŒ** â€” Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð·Ð½Ð°ÐµÑ‚, Ñ‡Ñ‚Ð¾ Ð´Ð°Ð½Ð½Ñ‹Ðµ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÑŽÑ‚ÑÑ

### Ð¥Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ…

Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹:
- Ð¥Ñ€Ð°Ð½ÑÑ‚ÑÑ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾ Ð² SQLite
- ÐÐµ Ð¿ÐµÑ€ÐµÐ´Ð°ÑŽÑ‚ÑÑ Ñ‚Ñ€ÐµÑ‚ÑŒÐ¸Ð¼ ÑÑ‚Ð¾Ñ€Ð¾Ð½Ð°Ð¼ (ÐºÑ€Ð¾Ð¼Ðµ LLM API)
- ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¾Ñ‡Ð¸Ñ‰Ð°ÑŽÑ‚ÑÑ Ð¿Ñ€Ð¸ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ð¸ Ð±Ð¾Ñ‚Ð° Ð¸Ð· Ñ‡Ð°Ñ‚Ð°

### ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…

ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐ°:

```python
# ÐŸÑ€Ð¸ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ð¸ Ð¸Ð· Ð³Ñ€ÑƒÐ¿Ð¿Ñ‹
@router.my_chat_member(...)
async def on_bot_removed(event: ChatMemberUpdated):
    if event.new_chat_member.status == "left":
        await db.delete_chat(event.chat.id)
```

Ð ÑƒÑ‡Ð½Ð°Ñ Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐ° Ñ‡ÐµÑ€ÐµÐ· `/forget`:

```python
@router.message(Command("forget"))
async def forget_command(message: Message):
    await db.clear_context(message.from_user.id)
```

## Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹

### ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑƒÑÐ·Ð²Ð¸Ð¼Ð¾ÑÑ‚ÐµÐ¹

```bash
# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° safety
pip install safety

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
safety check
```

### ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹

```bash
# ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ ÑƒÑÑ‚Ð°Ñ€ÐµÐ²ÑˆÐ¸Ñ… Ð¿Ð°ÐºÐµÑ‚Ð¾Ð²
pip list --outdated

# ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾Ð³Ð¾ Ð¿Ð°ÐºÐµÑ‚Ð°
pip install --upgrade aiogram

# ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð²ÑÐµÑ… (Ð¾ÑÑ‚Ð¾Ñ€Ð¾Ð¶Ð½Ð¾!)
pip install --upgrade -r requirements/requirements.txt
```

### Ð¤Ð¸ÐºÑÐ°Ñ†Ð¸Ñ Ð²ÐµÑ€ÑÐ¸Ð¹

Ð’ `requirements.txt` ÑƒÐºÐ°Ð·Ð°Ð½Ñ‹ Ñ‚Ð¾Ñ‡Ð½Ñ‹Ðµ Ð²ÐµÑ€ÑÐ¸Ð¸:

```txt
aiogram==3.20.0  # Ð¢Ð¾Ñ‡Ð½Ð°Ñ Ð²ÐµÑ€ÑÐ¸Ñ
aiosqlite>=0.19.0  # ÐœÐ¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ð°Ñ Ð²ÐµÑ€ÑÐ¸Ñ
```

Ð­Ñ‚Ð¾ Ð¿Ñ€ÐµÐ´Ð¾Ñ‚Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ð½ÐµÐ¾Ð¶Ð¸Ð´Ð°Ð½Ð½Ñ‹Ðµ breaking changes.

## Docker Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ

### Non-root Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ

Ð’ `Dockerfile` Ð±Ð¾Ñ‚ Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ Ð½Ðµ Ð¾Ñ‚ root:

```dockerfile
# Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
RUN adduser --disabled-password --gecos '' botuser

# ÐŸÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ÑÑ Ð½Ð° Ð½ÐµÐ³Ð¾
USER botuser

# Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ
CMD ["python", "main.py"]
```

### ÐœÐ¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¾Ð±Ñ€Ð°Ð·

Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ `python:3.14-slim` Ð²Ð¼ÐµÑÑ‚Ð¾ Ð¿Ð¾Ð»Ð½Ð¾Ð³Ð¾ Ð¾Ð±Ñ€Ð°Ð·Ð° Ð´Ð»Ñ ÑƒÐ¼ÐµÐ½ÑŒÑˆÐµÐ½Ð¸Ñ Ð¿Ð¾Ð²ÐµÑ€Ñ…Ð½Ð¾ÑÑ‚Ð¸ Ð°Ñ‚Ð°ÐºÐ¸.

### Ð ÐµÐ³ÑƒÐ»ÑÑ€Ð½Ñ‹Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ

```bash
# ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð±Ð°Ð·Ð¾Ð²Ð¾Ð³Ð¾ Ð¾Ð±Ñ€Ð°Ð·Ð°
docker-compose pull
docker-compose up -d --build
```

## Ð—Ð°Ñ‰Ð¸Ñ‚Ð° Ð¾Ñ‚ DDoS

### Rate Limiting Ð² ÐºÐ¾Ð´Ðµ

```python
# ÐžÐ³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ðµ Ñ‡Ð°ÑÑ‚Ð¾Ñ‚Ñ‹ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð½Ð° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
from collections import defaultdict
import time

user_last_request = defaultdict(float)
MIN_REQUEST_INTERVAL = 1.0  # ÑÐµÐºÑƒÐ½Ð´Ñ‹

async def check_rate_limit(user_id: int) -> bool:
    now = time.time()
    last = user_last_request[user_id]
    
    if now - last < MIN_REQUEST_INTERVAL:
        return False
    
    user_last_request[user_id] = now
    return True
```

### Telegram Ð²ÑÑ‚Ñ€Ð¾ÐµÐ½Ð½Ñ‹Ð¹ Rate Limiting

Telegram Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð±Ð»Ð¾ÐºÐ¸Ñ€ÑƒÐµÑ‚ Ð±Ð¾Ñ‚Ð¾Ð², ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ:
- ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÑŽÑ‚ ÑÐ»Ð¸ÑˆÐºÐ¾Ð¼ Ð¼Ð½Ð¾Ð³Ð¾ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹
- Ð¡Ð¾Ð²ÐµÑ€ÑˆÐ°ÑŽÑ‚ Ð¿Ð¾Ð´Ð¾Ð·Ñ€Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ
- ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÑŽÑ‚ Ð¼Ð½Ð¾Ð³Ð¾ Ð¶Ð°Ð»Ð¾Ð±

## ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸

### Ð›Ð¾Ð³Ð¸ Ð´Ð»Ñ Ð°Ð½Ð°Ð»Ð¸Ð·Ð°

```python
# Ð›Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð´Ð¾Ð·Ñ€Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð¹ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚Ð¸
if suspicious_pattern_detected:
    logger.warning(
        f"Suspicious activity from user {user_id}: "
        f"pattern={pattern}"
    )
```

### ÐÐ»ÐµÑ€Ñ‚Ñ‹

ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ñƒ:

```python
async def send_security_alert(message: str):
    """ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ Ð°Ð»ÐµÑ€Ñ‚ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ñƒ."""
    await bot.send_message(
        ADMIN_CHAT,
        f"ðŸš¨ Security Alert:\n{message}"
    )
```

## Ð—Ð°Ñ‰Ð¸Ñ‚Ð° CI/CD

### GitHub Secrets

Ð’ÑÐµ ÑÐµÐºÑ€ÐµÑ‚Ñ‹ Ñ…Ñ€Ð°Ð½ÑÑ‚ÑÑ Ð² GitHub Secrets:
- `SSH_HOST`
- `SSH_USER`
- `SSH_KEY`
- `ENV_FILE`

**Ð’Ð°Ð¶Ð½Ð¾:** ÐÐ¸ÐºÐ¾Ð³Ð´Ð° Ð½Ðµ Ð»Ð¾Ð³Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ secrets Ð² GitHub Actions.

### Ð—Ð°Ñ‰Ð¸Ñ‰ÐµÐ½Ð½Ñ‹Ðµ Ð²ÐµÑ‚ÐºÐ¸

ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ branch protection Ð´Ð»Ñ `main`:
- Require pull request reviews
- Require status checks to pass
- No force pushes

## Ð˜Ð½Ñ†Ð¸Ð´ÐµÐ½Ñ‚Ñ‹ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸

### Ð§Ñ‚Ð¾ Ð´ÐµÐ»Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¸ ÑƒÑ‚ÐµÑ‡ÐºÐµ Ñ‚Ð¾ÐºÐµÐ½Ð°

1. **ÐÐµÐ¼ÐµÐ´Ð»ÐµÐ½Ð½Ð¾** Ð¾Ñ‚Ð·Ð¾Ð²Ð¸Ñ‚Ðµ ÑÑ‚Ð°Ñ€Ñ‹Ð¹ Ñ‚Ð¾ÐºÐµÐ½ Ñ‡ÐµÑ€ÐµÐ· [@BotFather](https://t.me/BotFather)
2. Ð¡Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð½Ð¾Ð²Ñ‹Ð¹ Ñ‚Ð¾ÐºÐµÐ½
3. ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚Ðµ `.env` Ð¸ GitHub Secrets
4. ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ð±Ð¾Ñ‚Ð°
5. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð»Ð¾Ð³Ð¸ Ð½Ð° Ð¿Ð¾Ð´Ð¾Ð·Ñ€Ð¸Ñ‚ÐµÐ»ÑŒÐ½ÑƒÑŽ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ÑÑ‚ÑŒ
6. Ð˜Ð·Ð¼ÐµÐ½Ð¸Ñ‚Ðµ Ð²ÑÐµ ÑÐ²ÑÐ·Ð°Ð½Ð½Ñ‹Ðµ Ð¿Ð°Ñ€Ð¾Ð»Ð¸

### ÐšÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ñ‹ Ð´Ð»Ñ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹

Ð•ÑÐ»Ð¸ Ð¾Ð±Ð½Ð°Ñ€ÑƒÐ¶Ð¸Ð»Ð¸ ÑƒÑÐ·Ð²Ð¸Ð¼Ð¾ÑÑ‚ÑŒ:
- Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð¿Ñ€Ð¸Ð²Ð°Ñ‚Ð½Ñ‹Ð¹ Security Advisory Ð½Ð° GitHub
- Ð˜Ð»Ð¸ Ð½Ð°Ð¿Ð¸ÑˆÐ¸Ñ‚Ðµ Ð°Ð²Ñ‚Ð¾Ñ€Ñƒ: [t.me/nikpeg](https://t.me/nikpeg)

**ÐÐµ Ð¿ÑƒÐ±Ð»Ð¸ÐºÑƒÐ¹Ñ‚Ðµ** Ð´ÐµÑ‚Ð°Ð»Ð¸ ÑƒÑÐ·Ð²Ð¸Ð¼Ð¾ÑÑ‚Ð¸ Ð² Issues Ð´Ð¾ ÐµÑ‘ Ð¸ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ.

## Best Practices

### 1. ÐŸÑ€Ð¸Ð½Ñ†Ð¸Ð¿ Ð¼Ð¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ñ… Ð¿Ñ€Ð¸Ð²Ð¸Ð»ÐµÐ³Ð¸Ð¹

Ð‘Ð¾Ñ‚ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¸Ð¼ÐµÑ‚ÑŒ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹Ðµ Ñ€Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð¸Ñ:

```python
# Ð’ BotFather Ð¾Ñ‚ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ðµ Ð½ÐµÐ¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼Ñ‹Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸
# /setprivacy - Enable Ð´Ð»Ñ Ð³Ñ€ÑƒÐ¿Ð¿ (ÐµÑÐ»Ð¸ Ð½Ðµ Ð½ÑƒÐ¶Ð½Ð¾ Ð²Ð¸Ð´ÐµÑ‚ÑŒ Ð²ÑÐµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ)
# /setjoingroups - Disable (ÐµÑÐ»Ð¸ Ð½Ðµ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð² Ð³Ñ€ÑƒÐ¿Ð¿Ð°Ñ…)
```

### 2. Ð ÐµÐ³ÑƒÐ»ÑÑ€Ð½Ñ‹Ðµ Ð°ÑƒÐ´Ð¸Ñ‚Ñ‹

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸ ÐºÐ¾Ð´Ð°
bandit -r .

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
safety check

# ÐÐ½Ð°Ð»Ð¸Ð· Docker Ð¾Ð±Ñ€Ð°Ð·Ð°
docker scan mybot:latest
```

### 3. Ð Ð°Ð·Ð´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ð¹

```env
# .env.dev
TG_TOKEN=dev_token
LLM_TOKEN=dev_token
DEBUG=True

# .env.prod
TG_TOKEN=prod_token
LLM_TOKEN=prod_token
DEBUG=False
```

### 4. Ð ÐµÐ·ÐµÑ€Ð²Ð½Ð¾Ðµ ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ

```bash
# Ð ÐµÐ³ÑƒÐ»ÑÑ€Ð½Ñ‹Ð¹ Ð±ÑÐºÐ°Ð¿ Ð‘Ð”
sqlite3 data/users.db ".backup 'backup/users_$(date +%Y%m%d).db'"

# ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ‡ÐµÑ€ÐµÐ· cron
0 3 * * * /path/to/backup_script.sh
```

## Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ðµ Ñ€ÐµÑÑƒÑ€ÑÑ‹

- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [Telegram Bot Security](https://core.telegram.org/bots/security)
- [Python Security Best Practices](https://python.readthedocs.io/en/stable/library/security_warnings.html)
- [Docker Security](https://docs.docker.com/engine/security/)

